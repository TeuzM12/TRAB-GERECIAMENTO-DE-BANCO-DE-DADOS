CREATE SCHEMA AUTHORIZATION USR_IMOBILIARIA;

CREATE TABLE USR_IMOBILIARIA.CLIENTES (
    CLIENTE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    TELEFONE VARCHAR2(15) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE,
    ENDERECO VARCHAR2(255) NOT NULL
);

CREATE TABLE USR_IMOBILIARIA.PROPRIETARIOS (
    PROPRIETARIO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    TELEFONE VARCHAR2(15) NOT NULL,
    EMAIL VARCHAR2(100) NOT NULL UNIQUE
);

CREATE TABLE USR_IMOBILIARIA.PROPRIEDADES (
    PROPRIEDADE_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    ENDERECO VARCHAR2(255) NOT NULL,
    TIPO VARCHAR2(50) NOT NULL,
    PRECO NUMBER(15, 2) NOT NULL CHECK (PRECO > 0),
    STATUS VARCHAR2(50) NOT NULL DEFAULT 'DISPONIVEL'
);

CREATE TABLE USR_IMOBILIARIA.CONTRATOS (
    CONTRATO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROPRIEDADE_ID NUMBER NOT NULL,
    PROPRIETARIO_ID NUMBER NOT NULL,
    CLIENTE_ID NUMBER,
    DATA_INICIO DATE NOT NULL,
    DATA_FIM DATE,
    VALOR_MENSAL NUMBER(10, 2) NOT NULL CHECK (VALOR_MENSAL > 0),
    TIPO VARCHAR2(50) NOT NULL,
    CONSTRAINT FK_CONTRATOS_PROPRIEDADE FOREIGN KEY (PROPRIEDADE_ID) REFERENCES USR_IMOBILIARIA.PROPRIEDADES (PROPRIEDADE_ID),
    CONSTRAINT FK_CONTRATOS_PROPRIETARIO FOREIGN KEY (PROPRIETARIO_ID) REFERENCES USR_IMOBILIARIA.PROPRIETARIOS (PROPRIETARIO_ID),
    CONSTRAINT FK_CONTRATOS_CLIENTE FOREIGN KEY (CLIENTE_ID) REFERENCES USR_IMOBILIARIA.CLIENTES (CLIENTE_ID)
);

CREATE TABLE USR_IMOBILIARIA.MANUTENCOES_PROPRIEDADE (
    MANUTENCAO_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PROPRIEDADE_ID NUMBER NOT NULL,
    DATA_MANUTENCAO DATE NOT NULL,
    DESCRICAO CLOB NOT NULL,
    CUSTO NUMBER(10, 2) NOT NULL CHECK (CUSTO >= 0),
    CONSTRAINT FK_MANUTENCOES_PROPRIEDADE FOREIGN KEY (PROPRIEDADE_ID) REFERENCES USR_IMOBILIARIA.PROPRIEDADES (PROPRIEDADE_ID)
);

CREATE INDEX IDX_CLIENTES_EMAIL ON USR_IMOBILIARIA.CLIENTES (EMAIL);
CREATE INDEX IDX_PROPRIETARIOS_EMAIL ON USR_IMOBILIARIA.PROPRIETARIOS (EMAIL);
CREATE INDEX IDX_PROPRIEDADES_TIPO ON USR_IMOBILIARIA.PROPRIEDADES (TIPO);
CREATE INDEX IDX_CONTRATOS_TIPO ON USR_IMOBILIARIA.CONTRATOS (TIPO);
